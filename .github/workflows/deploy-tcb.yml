name: Deploy LibreTV to Tencent CloudBase

on:
  push:
    branches:
      - main 

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Setup Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18' 

    - name: Install dependencies
      run: npm install

    - name: Install CloudBase CLI
      run: npm install -g @cloudbase/cli

    - name: Deploy to Tencent CloudBase Static Hosting (using CLI)
      run: |
        tcb logout # 先登出，确保是新的登录
        tcb login --secretId ${{ secrets.TENCENT_CLOUD_SECRET_ID }} --secretKey ${{ secrets.TENCENT_CLOUD_SECRET_KEY }} -vv # 登录并开启详细日志
        tcb env use ${{ secrets.TENCENT_CLOUD_ENV_ID }} -vv # 切换环境并开启详细日志
        tcb hosting deploy ${GITHUB_WORKSPACE} -e ${{ secrets.TENCENT_CLOUD_ENV_ID }} -vv # 部署并开启详细日志
      env:
        GITHUB_WORKSPACE: ${{ github.workspace }}
