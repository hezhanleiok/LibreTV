name: Deploy LibreTV to Tencent CloudBase

on:
  push:
    branches:
      - main 

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Setup Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '16' 

    - name: Install dependencies
      run: npm install # 尽管没有build，但项目可能有其他依赖需要安装，保留此步

    - name: Install CloudBase CLI
      run: npm install -g @cloudbase/cli

    - name: Deploy to Tencent CloudBase Static Hosting (using CLI)
      run: |
        tcb login --secretId ${{ secrets.TENCENT_CLOUD_SECRET_ID }} --secretKey ${{ secrets.TENCENT_CLOUD_SECRET_KEY }}
        tcb env use ${{ secrets.TENCENT_CLOUD_ENV_ID }}
        tcb hosting deploy ${GITHUB_WORKSPACE} -e ${{ secrets.TENCENT_CLOUD_ENV_ID }} # 【关键修改！】部署整个工作区根目录
      env:
        GITHUB_WORKSPACE: ${{ github.workspace }} 
