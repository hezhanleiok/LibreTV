name: Deploy LibreTV to Tencent CloudBase

on:
  push:
    branches:
      - main 

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Setup Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '16' 

    - name: Install dependencies
      run: npm install

    - name: Build LibreTV
      run: npm run build 

    - name: Install CloudBase CLI
      run: npm install -g @cloudbase/cli # 安装腾讯云开发命令行工具

    - name: Deploy to Tencent CloudBase Static Hosting (using CLI)
      run: |
        tcb login --secretId ${{ secrets.TENCENT_CLOUD_SECRET_ID }} --secretKey ${{ secrets.TENCENT_CLOUD_SECRET_KEY }} # 登录
        tcb env use ${{ secrets.TENCENT_CLOUD_ENV_ID }} # 切换到你的云开发环境
        tcb hosting deploy ${GITHUB_WORKSPACE}/dist -e ${{ secrets.TENCENT_CLOUD_ENV_ID }} # 部署静态网站
      env:
        GITHUB_WORKSPACE: ${{ github.workspace }} # 定义工作区路径
